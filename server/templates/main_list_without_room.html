{% extends "base.html" %}

{% block custom_header %}
<style>
    {% for category in categories.values() %}
        {{ self::styles_for_category(category) }}
    {% endfor %}
</style>
{% endblock %}

{% block body %}
<div class="container mt-3" id="main">
    <h1>
        KüA-Plan, KüAs ohne Ort
    </h1>

    <div class="d-none d-print-block">
        Stand: {{ to_our_timezone(&chrono::offset::Utc::now()).format("%d.%m. %H:%M") }}
    </div>

    {% if entry_blocks.is_empty() %}
        <div class="alert alert-info mt-4">
            <i class="bi bi-info-circle" aria-hidden="true"></i>
            Aktuell sind keine KüAs ohne Raum geplant.
        </div>
    {% endif %}

    {% for (date, rows) in entry_blocks %}
        <h3 class="mt-4">
            {{ date|weekday }}, {{ date.format("%d.%m.%Y") }}
            {% if *date == self::current_effective_date(event.clock_info) %}
                <span class="d-print-none">(heute)</span>
            {% endif %}
        </h3>
        <table class="table table-striped kuealist">
            <thead>
            <tr>
                <th scope="col">Was?</th>
                <th scope="col">Wann?</th>
                <th scope="col">Wo?</th>
                <th scope="col">Von wem?</th>
            </tr>
            </thead>
            <tbody>
                {% for row in rows %}
                    {% let category = categories.get(row.entry.entry.category).ok_or("Category not found")? %}
                    {{ MainListRowTemplate::new(base.request, **row, category, rooms, event.clock_info)
                           .show_edit_links(base.has_privilege(Privilege::ManageEntries))
                           .show_description_links(true)
                           .date_context(**date)
                           .main_entry_link_mode(MainEntryLinkMode::ByRoomContext) }}
                {% endfor %}
            </tbody>
        </table>
    {% endfor %}

    {% if !entries_with_descriptions.is_empty() %}
        <hr class="mb-5 mt-5 d-print-none"/>
        <h2 style="page-break-before: always;">Beschreibungen</h2>
        {% for entry in entries_with_descriptions %}
            {{ EntryDescriptionTemplate::new(entry, rooms, event.clock_info.timezone) }}
        {% endfor %}
    {% endif %}
</div>
{% endblock %}

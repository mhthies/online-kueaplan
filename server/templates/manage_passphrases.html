{% extends "base_config.html" %}

{% block config_content %}
    <h1>Passphrasen</h1>
    <div class="mb-3">
        <a href="{{ base.url_for_event_endpoint("new_passphrase_form")? }}" class="btn btn-outline-success">
            <i class="bi bi-plus-lg" aria-hidden="true"></i> Passphrase hinzufügen
        </a>
    </div>
    <div class="table-responsive-lg">
        <table class="table align-middle table-hover">
            <thead>
                <tr>
                    <th scope="col">Rolle</th>
                    <th scope="col">Passphrase</th>
                    <th scope="col">Gültigkeit</th>
                    <th scope="col">Kommentar</th>
                    <th scope="col"><span class="visually-hidden">Aktionen</span></th>
                </tr>
            </thead>
            <tbody>
                {% if sorted_passphrases.is_empty() %}
                    <tr><td colspan="6" class="text-info">– Aktuell gibt es keine Passphrasen. –</td></tr>
                {% endif %}
                {% for (passphrase, derivable_passphrases) in sorted_passphrases %}
                    <tr>
                        <td>{{self::format_access_role(passphrase.privilege)}}</td>
                        <td>{{self::format_passphrase(passphrase.passphrase)}}</td>
                        <td>{{format_datetime_or_infinity(passphrase.valid_from)}} – {{format_datetime_or_infinity(passphrase.valid_until)}}</td>
                        <td>{{passphrase.comment}}</td>
                        <td class="shrink-to-content">
                            {% if passphrase.privilege.can_be_managed_online() %}
                                <a href="{{ base.request.url_for("delete_passphrase_form", [&event.basic_data.id.to_string(), &passphrase.id.to_string()])? }}" class="btn btn-sm btn-outline-danger" title="Passphrase löschen"><i class="bi bi-trash"></i></a>
                            {% endif %}
                            {% if passphrase.passphrase.is_some() %}
                                <a href="{{ base.request.url_for("new_derivable_sharable_link_passphrase_form", [&event.basic_data.id.to_string(), &passphrase.id.to_string()])? }}"
                                    class="btn btn-sm btn-outline-success"
                                    title="Ableitbare Rolle für Abruf per Link hinzufügen">
                                    <i class="bi bi-plus-circle"></i> <i class="bi bi-share"></i>
                                </a>
                            {% endif %}
                        </td>
                    </tr>
                    {% for passphrase in derivable_passphrases %}
                        <tr>
                            <td>
                                &emsp;<i class="bi bi-arrow-return-right text-secondary" title="ableitbar zu"></i>
                                {{self::format_access_role(passphrase.privilege)}}
                            </td>
                            <td>{{self::format_passphrase(passphrase.passphrase)}}</td>
                            <td>{{format_datetime_or_infinity(passphrase.valid_from)}} – {{format_datetime_or_infinity(passphrase.valid_until)}}</td>
                            <td>{{passphrase.comment}}</td>
                            <td class="shrink-to-content">
                                {% if passphrase.privilege.can_be_managed_online() %}
                                    <a href="{{ base.request.url_for("delete_passphrase_form", [&event.basic_data.id.to_string(), &passphrase.id.to_string()])? }}" class="btn btn-sm btn-outline-danger" title="Ableitbare Rolle löschen"><i class="bi bi-trash"></i></a>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                {% endfor %}
                {% if !unsorted_passphrases.is_empty() %}
                    <tr><td colspan="3" class="text-secondary">Nicht korrekt zugeordnet</td></tr>
                    {% for passphrase in unsorted_passphrases %}
                        <tr>
                            <td>
                                &emsp;<i class="bi bi-arrow-return-right text-secondary" title="ableitbar von irgendwas"></i>
                                {{self::format_access_role(passphrase.privilege)}}
                            </td>
                            <td>{{self::format_passphrase(passphrase.passphrase)}}</td>
                            <td>{{format_datetime_or_infinity(passphrase.valid_from)}} – {{format_datetime_or_infinity(passphrase.valid_until)}}</td>
                            <td>{{passphrase.comment}}</td>
                            <td class="shrink-to-content">
                                {% if passphrase.privilege.can_be_managed_online() %}
                                    <a href="{{ base.request.url_for("delete_passphrase_form", [&event.basic_data.id.to_string(), &passphrase.id.to_string()])? }}" class="btn btn-sm btn-outline-danger" title="Ableitbare Rolle löschen"><i class="bi bi-trash"></i></a>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                {% endif %}
            </tbody>
        </table>
    </div>
{% endblock %}

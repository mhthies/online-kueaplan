{% extends "base.html" %}

{% block custom_header %}
<style>
    {% for category in categories.values() %}
    {{ category|styles_for_category }}
    {% endfor %}
</style>
{% endblock %}

{% block body %}
<nav class="navbar navbar-expand sticky-top bg-body-tertiary">
    <div class="container">
        <a class="navbar-brand" href="#">{{ event.title }}</a>
        <ul class="navbar-nav me-auto">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    {{ date|weekday_short }} {{ date.format("%d.%m.") }}
                </a>
                <ul class="dropdown-menu">
                    {% for day in event_days %}
                        <li><a class="dropdown-item {% if *day == date %}active{% endif %}" href="{{ url_for_main_list(day)? }}">{{ day|weekday_short }} {{ day.format("%d.%m.") }}</a></li>
                    {% endfor %}
                </ul>
            </li>
        </ul>
    </div>
</nav>
<div class="container mt-3" id="main">
    <h1>
        KüA-Plan {{ date|weekday }}, {{ date.format("%d.%m.%Y") }}
    </h1>
    {% for (block_name, entries) in entry_blocks %}
        {% if entry_blocks.len() > 1 %}<h3>{{ block_name }}</h3>{% endif %}
        <table class="table table-striped kuealist">
            <thead>
            <tr>
                <th>Was?</th>
                <th>Wann?</th>
                <th>Wo?</th>
                <th>Von wem?</th>
            </tr>
            </thead>
            <tbody>
                {% for entry in entries %}
                    <tr class="{{ css_class_for_entry(entry) }} aside-container">
                        <td class="kuea-title" id="entry-{{ entry.entry.id.to_string() }}">
                            {% if entry.entry.is_cancelled %}
                                <span class="visually-hidden">Abgesagt: </span>
                            {% endif %}
                            <span class="content">{{ entry.entry.title }}</span>
                            {% if user_can_edit_entries %}
                            <div class="table-aside-buttons">
                                <a href="{{ url_for_edit_entry(entry)? }}" aria-label="Eintrag bearbeiten"
                                   title="Eintrag &quot;{{entry.entry.title|ellipsis(30)}}&quot; bearbeiten">
                                    <i class="bi-pencil" aria-hidden="true"></i></a>
                            </div>
                            {% endif %}
                            {% if !entry.entry.description.is_empty() %}
                                <a href="#entry-desc-{{ entry.entry.id.to_string() }}" title="Zur Beschreibung"><i class="bi-blockquote-left"></i></a>
                            {% endif %}
                            {% if !entry.entry.comment.is_empty() %}
                                <div class="comment">{{ entry.entry.comment }}</div>
                            {% endif %}
                        </td>
                        <td class="kuea-time">
                            {{ to_our_timezone(entry.entry.begin).format("%H:%M") }}&nbsp;– {{ to_our_timezone(entry.entry.end).format("%H:%M") }}
                            {% if !entry.entry.time_comment.is_empty() %}
                                <div class="comment">{{ entry.entry.time_comment }}</div>
                            {% endif %}
                        </td>
                        <td class="kuea-place">
                            {% for room_id in entry.room_ids %}
                                {{ rooms[room_id].title }}{% if !loop.last %}, {% endif -%}
                            {% endfor %}
                            {% if !entry.entry.room_comment.is_empty() %}
                                <div class="comment">{{ entry.entry.room_comment }}</div>
                            {% endif %}
                        </td>
                        <td class="kuea-people">{{ entry.entry.responsible_person }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        </table>
    {% endfor %}

    {% if !entries_with_descriptions.is_empty() %}
        <h2 style="page-break-before: always;">Beschreibungen</h2>
        {% for entry in entries_with_descriptions %}
            <h3 id="entry-desc-{{ entry.entry.id.to_string() }}">{{ entry.entry.title }} <a href="#entry-{{ entry.entry.id.to_string() }}" class="entry-backlink"><i class="bi-link"></i></a></h3>
            {{ entry.entry.description|markdown }}
        {% endfor %}
    {% endif %}
</div>
{% endblock %}
